<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Techniques - Hirpdag</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="favicon.svg">
                        <link rel="shortcut icon" href="favicon.png">
                <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
                <link rel="stylesheet" href="css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="ch01-00-introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="ch02-00-hirpdag.html"><strong aria-hidden="true">2.</strong> Hirpdag</a></li><li class="chapter-item expanded "><a href="ch03-00-implementation.html"><strong aria-hidden="true">3.</strong> Implementation</a></li><li class="chapter-item expanded "><a href="ch04-00-techniques.html" class="active"><strong aria-hidden="true">4.</strong> Techniques</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">Hirpdag</h1>

                    <div class="right-buttons">
                                                <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="techniques"><a class="header" href="#techniques">Techniques</a></h1>
<p>Techniques for using Hirpdag to maximize effectiveness.</p>
<h2 id="referential-transparency"><a class="header" href="#referential-transparency">Referential Transparency</a></h2>
<p><a href="https://en.m.wikipedia.org/wiki/Referential_transparency">Referential Transparency @ Wikipedia</a></p>
<p>Hirpdag objects should generally be designed to have referential transparency.</p>
<p>Objects which are identical should not have different meanings in a different context/environment.</p>
<h2 id="common-normalization"><a class="header" href="#common-normalization">Common Normalization</a></h2>
<p>Hirpdag objects should apply normalization to increase the effectiveness of hashconsing.</p>
<p>Normalization is important for pointer inequality to correspond with semantic inequality.
Fast pointer equality based comparisons is one of the key features hash consing provides.
Without good normalization, deeper comparisons are needed and the pointer equality benefit of hashconsing is lost.</p>
<h3 id="order-normalization"><a class="header" href="#order-normalization">Order Normalization</a></h3>
<p><code>y+x</code>
<code>x+y</code></p>
<p>Sort commutative operands. Prefer flatter expression trees to make this easier.</p>
<h3 id="semantic-normalization"><a class="header" href="#semantic-normalization">Semantic Normalization</a></h3>
<p><code>x+x</code>
<code>2*x</code></p>
<h2 id="structuring-for-persistence-and-normalization"><a class="header" href="#structuring-for-persistence-and-normalization">Structuring for Persistence and Normalization</a></h2>
<p>The structure of Hirpdag objects can have a big impact on the effectiveness of normalization and persistence.</p>
<h3 id="prefer-flatter-structures"><a class="header" href="#prefer-flatter-structures">Prefer Flatter Structures</a></h3>
<p>Consider:</p>
<ul>
<li><code>A=a+b+d+e</code></li>
</ul>
<p>As a binary tree (before normalization) it might look like:</p>
<ul>
<li><code>a=b=sum(a, sum(b, sum(d, e)))</code></li>
<li><code>a=b=sum(sum(a, b), sum(d, e))</code></li>
<li><code>a=b=sum(sum(sum(a, b), d), e)</code></li>
</ul>
<p>With a binary tree representation, the first question is: which of these semantically equivalent structures is the normalized form?</p>
<p>Consider:</p>
<ul>
<li><code>B=a+d+b+e</code></li>
</ul>
<p>As a binary tree (before normalization) it might look like:</p>
<ul>
<li><code>B=Sum(Sum(a, d), Sum(b, e))</code></li>
</ul>
<p><code>B</code> is semantically equivalent to <code>A</code>, and should normalize to the same thing.
In this case, the order of the operands needs to change.</p>
<p>With a binary tree representation, the second question is: what is necessary to normalized the operand order?
Traversing the existing tree is necessary to gather these operands for sorting.
Performance wise, this is similar to traversing a linked list (i.e: bad).</p>
<p>As a n-ary tree:
A=Sum(a, b, d, e)</p>
<p>More contiguous. Easier to sort. Easier to traverse. Easier to construct. Easier to normalize (just sort).</p>
<p>When used as a persistent data structure, this means changing one n-ary Sum object rather than several binary Sum objects.</p>
<p>In general, if a Hirpdag object can refer to other Hirpdag objects of the same type and ordering is not important,
this suggests you should consider changing their structure to combine them into one flattened Hirpdag object.</p>
<h3 id="not-too-big-not-too-small"><a class="header" href="#not-too-big-not-too-small">Not too big, not too small</a></h3>
<p>If a Hirpdag object has too much information, deduplication opportunities will be unlikely.</p>
<p>If a Hirpdag object has too little information, encoding a useful piece of information will require many objects.
This will have a negative impact on performance due to:</p>
<ul>
<li>Worse memory access patterns chasing pointers (like a linked list).</li>
<li>More time spent allocating/deallocating.</li>
</ul>
<p>Consider which fields may be large (e.g. a vector field may grow large).
Consider which fields will need to mutate together.</p>
<h3 id="encoding-graphs"><a class="header" href="#encoding-graphs">Encoding Graphs</a></h3>
<p>If the graph to store is acyclic, it could be directly constructed.</p>
<p>If the nodes or edges carry some information, they should likely be separate nodes.
This makes the graph better for persistence.</p>
<p>An <a href="https://en.m.wikipedia.org/wiki/Adjacency_list">adjacency list</a> or <a href="https://en.m.wikipedia.org/wiki/Edge_list">edge list</a> can encode the graph structure itself.</p>
<pre><code>type NodeIndex = u32;

struct Node {
  name: String,
}

struct Graph {
  nodes: Vec&lt;Node&gt;,
  edges: Vec&lt;(NodeIndex, NodeIndex)&gt;, // Sorted
}
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="ch03-00-implementation.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="ch03-00-implementation.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
